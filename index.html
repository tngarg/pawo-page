<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omnichannel Optimizer | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fira+Code:wght@400;500&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            height: 100vh;
            overflow: hidden; /* Prevent body scroll to fit 14" screen */
        }

        .terminal-text {
            font-family: 'Fira Code', monospace;
            font-size: 0.75rem;
        }

        .step-active { 
            border-bottom: 3px solid #00A3AD;
            background: #f0fdfa;
            transform: translateY(-2px);
        }

        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        /* Animation for graph bars */
        .bar-grow {
            transition: height 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
    </style>
</head>
<body class="flex flex-col">

    <!-- Compact Header -->
    <header class="bg-[#002d62] text-white px-6 py-2 flex justify-between items-center shrink-0">
        <div class="flex items-center gap-2">
            <i class="fa-solid fa-dna text-[#00A3AD]"></i>
            <h1 class="text-sm font-bold uppercase tracking-widest">Omnichannel <span class="text-[#00A3AD]">Optimizer</span></h1>
        </div>
        <div class="flex items-center gap-4 text-xs">
            <div id="api-indicator" class="flex items-center gap-1.5 bg-red-500/10 px-2 py-0.5 rounded border border-red-500/30 text-red-400">
                <div class="w-1.5 h-1.5 rounded-full bg-red-500"></div>
                Local Mode
            </div>
            <button onclick="toggleSettings()" class="opacity-70 hover:opacity-100"><i class="fa-solid fa-gear"></i></button>
        </div>
    </header>

    <!-- Main Workspace -->
    <main class="flex-1 flex overflow-hidden p-4 gap-4">
        
        <!-- Sidebar: Inputs (Left) -->
        <aside class="w-72 flex flex-col gap-4 shrink-0">
            <!-- Controls -->
            <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-200">
                <h3 class="text-xs font-bold text-slate-400 uppercase mb-3">Brand Control</h3>
                <div class="space-y-3">
                    <div>
                        <label class="text-[10px] font-bold text-slate-500 uppercase">Molecule</label>
                        <select id="brand-select" class="w-full text-sm p-2 border rounded-lg bg-slate-50 outline-none focus:border-[#00A3AD]">
                            <option value="respirax">Respirax (Asthma)</option>
                            <option value="cardiovast">CardioVast (Heart)</option>
                            <option value="glycoguard">GlycoGuard (Diabetes)</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-500 uppercase">Targeting</label>
                        <select id="segment-select" class="w-full text-sm p-2 border rounded-lg bg-slate-50 outline-none focus:border-[#00A3AD]">
                            <option value="specialists">Specialists</option>
                            <option value="gp">GP Network</option>
                        </select>
                    </div>
                    <button onclick="runAgent()" class="w-full bg-[#00A3AD] text-white py-2.5 rounded-lg text-sm font-bold hover:brightness-105 transition-all shadow-md shadow-teal-500/20">
                        Execute Process
                    </button>
                </div>
            </div>

            <!-- Terminal -->
            <div class="bg-slate-900 rounded-xl p-3 flex-1 flex flex-col overflow-hidden shadow-inner border border-slate-800">
                <div class="flex justify-between items-center mb-2 border-b border-slate-800 pb-1">
                    <span class="text-[9px] text-slate-500 font-bold uppercase tracking-widest">Reasoning Log</span>
                    <div class="flex gap-1">
                        <div class="w-1.5 h-1.5 rounded-full bg-red-500/30"></div>
                        <div class="w-1.5 h-1.5 rounded-full bg-yellow-500/30"></div>
                        <div class="w-1.5 h-1.5 rounded-full bg-green-500/30"></div>
                    </div>
                </div>
                <div id="terminal" class="flex-1 overflow-y-auto custom-scroll terminal-text text-teal-400 space-y-1">
                    <div class="opacity-40 italic mt-1">> System Idle...</div>
                </div>
            </div>
        </aside>

        <!-- Content Area (Right) -->
        <section class="flex-1 flex flex-col gap-4 overflow-hidden">
            
            <!-- PAWO Steps (Horizontal) -->
            <div class="grid grid-cols-4 gap-2 shrink-0">
                <div id="step-p" class="bg-white p-2.5 rounded-lg flex items-center gap-3 border border-slate-200 transition-all duration-300">
                    <div class="w-6 h-6 rounded-full bg-slate-100 flex items-center justify-center text-[10px] font-bold">P</div>
                    <span class="text-xs font-bold text-slate-600">Plan</span>
                </div>
                <div id="step-a" class="bg-white p-2.5 rounded-lg flex items-center gap-3 border border-slate-200 transition-all duration-300 opacity-50">
                    <div class="w-6 h-6 rounded-full bg-slate-100 flex items-center justify-center text-[10px] font-bold">A</div>
                    <span class="text-xs font-bold text-slate-600">Act</span>
                </div>
                <div id="step-w" class="bg-white p-2.5 rounded-lg flex items-center gap-3 border border-slate-200 transition-all duration-300 opacity-50">
                    <div class="w-6 h-6 rounded-full bg-slate-100 flex items-center justify-center text-[10px] font-bold">W</div>
                    <span class="text-xs font-bold text-slate-600">Work</span>
                </div>
                <div id="step-o" class="bg-white p-2.5 rounded-lg flex items-center gap-3 border border-slate-200 transition-all duration-300 opacity-50">
                    <div class="w-6 h-6 rounded-full bg-slate-100 flex items-center justify-center text-[10px] font-bold">O</div>
                    <span class="text-xs font-bold text-slate-600">Optimize</span>
                </div>
            </div>

            <!-- Visualization Grid -->
            <div class="flex-1 grid grid-rows-2 gap-4 overflow-hidden">
                
                <!-- Row 1: The Graph (ML Planning) -->
                <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-200 flex flex-col">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-xs font-bold text-[#002d62] uppercase">ML Brain: Potential Analysis</h3>
                        <div class="flex gap-4 text-[10px] font-bold text-slate-400">
                            <span id="peak-indicator">PEAK: -</span>
                            <span class="text-teal-500">CORR: 0.94</span>
                        </div>
                    </div>
                    <!-- Chart Container -->
                    <div id="graph-container" class="flex-1 flex items-end gap-1.5 px-2 pb-1 pt-4 border-b border-l border-slate-100 relative">
                        <!-- Bars injected by JS -->
                        <div id="empty-graph" class="absolute inset-0 flex items-center justify-center text-slate-300 text-xs italic">
                            Awaiting Data Ingestion...
                        </div>
                    </div>
                </div>

                <!-- Row 2: Gen AI Work Results -->
                <div class="grid grid-cols-2 gap-4 overflow-hidden">
                    <!-- Email Card -->
                    <div class="bg-white rounded-xl border border-slate-200 p-4 flex flex-col overflow-hidden">
                        <div class="flex justify-between items-center mb-2 shrink-0">
                            <h4 class="text-[10px] font-bold text-slate-400 uppercase">Generated Email</h4>
                            <i class="fa-solid fa-envelope text-blue-400 text-xs"></i>
                        </div>
                        <div id="email-view" class="flex-1 bg-slate-50 rounded-lg p-3 text-[11px] overflow-y-auto custom-scroll text-slate-700 leading-relaxed border border-slate-100">
                            <div class="text-slate-300 italic text-center mt-10">Initializing Work Phase...</div>
                        </div>
                    </div>
                    <!-- Banner Card -->
                    <div class="bg-white rounded-xl border border-slate-200 p-4 flex flex-col overflow-hidden">
                        <div class="flex justify-between items-center mb-2 shrink-0">
                            <h4 class="text-[10px] font-bold text-slate-400 uppercase">Banner Asset</h4>
                            <i class="fa-solid fa-palette text-purple-400 text-xs"></i>
                        </div>
                        <div id="banner-view" class="flex-1 bg-slate-50 rounded-lg flex flex-col items-center justify-center p-4 border border-slate-100">
                            <div class="text-slate-300 italic text-xs">Awaiting Generation...</div>
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <!-- Settings Overlay -->
    <div id="settings-modal" class="fixed inset-0 bg-slate-900/60 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl p-6 w-80 shadow-2xl">
            <h2 class="font-bold text-sm mb-4">Gemini API Config</h2>
            <input type="password" id="api-key-input" placeholder="Enter API Key" class="w-full text-sm p-2 border rounded-lg mb-4 outline-none focus:ring-1 focus:ring-[#00A3AD]">
            <div class="flex gap-2">
                <button onclick="saveSettings()" class="flex-1 bg-[#002d62] text-white text-xs py-2 rounded-lg font-bold">Save</button>
                <button onclick="toggleSettings()" class="flex-1 bg-slate-100 text-xs py-2 rounded-lg font-bold">Cancel</button>
            </div>
        </div>
    </div>
	
	<script>
  const sleep = (ms) => new Promise(r => setTimeout(r, ms));
</script>

    <script>
const DEFAULT_GEMINI_KEY = "AIzaSyAyN-pge120c99FSZrRSv7L7LuDCiz9gPU"; // <-- optional

// 2) Initialize apiKey from the default
let apiKey = (DEFAULT_GEMINI_KEY || "").trim();
let isRunning = false;
        const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        const brandData = {
            respirax: { name: "Respirax", peak: "October", focus: "Winter Prep", values: [35, 42, 50, 48, 40, 32, 25, 40, 78, 98, 85, 75] },
            cardiovast: { name: "CardioVast", peak: "January", focus: "Screenings", values: [95, 82, 70, 60, 55, 50, 45, 52, 60, 68, 75, 85] },
            glycoguard: { name: "GlycoGuard", peak: "May", focus: "Adherence", values: [55, 60, 75, 85, 96, 82, 72, 68, 65, 70, 78, 72] }
        };

function updateApiIndicator() {
  const indicator = document.getElementById('api-indicator');
  if (apiKey) {
    indicator.innerHTML = `<div class="w-1.5 h-1.5 rounded-full bg-green-500"></div>Active`;
    indicator.className = "flex items-center gap-1.5 bg-green-500/10 px-2 py-0.5 rounded border border-green-500/30 text-green-500";
  } else {
    indicator.innerHTML = `<div class="w-1.5 h-1.5 rounded-full bg-red-500"></div>Local Mode`;
    indicator.className = "flex items-center gap-1.5 bg-red-500/10 px-2 py-0.5 rounded border border-red-500/30 text-red-400";
  }
}

        function toggleSettings() { document.getElementById('settings-modal').classList.toggle('hidden'); }
        
        function saveSettings() {
  apiKey = document.getElementById('api-key-input').value.trim();
  updateApiIndicator();
  toggleSettings();
}


        async function log(msg, color = "teal-400") {
            const terminal = document.getElementById('terminal');
            const entry = document.createElement('div');
            entry.className = `text-${color}`;
            entry.innerHTML = `<span class="opacity-30">></span> ${msg}`;
            terminal.appendChild(entry);
            terminal.scrollTop = terminal.scrollHeight;
            await new Promise(r => setTimeout(r, 600));
        }

        function setStep(id) {
            ['p','a','w','o'].forEach(s => {
                const el = document.getElementById(`step-${s}`);
                el.classList.toggle('step-active', s === id);
                el.classList.toggle('opacity-50', s !== id);
            });
        }

        async function runAgent() {
            if (isRunning) return;
            isRunning = true;
            
            const brandKey = document.getElementById('brand-select').value;
            const data = brandData[brandKey];
            
            // Initial UI Clear
            document.getElementById('terminal').innerHTML = "";
            document.getElementById('empty-graph').style.display = 'none';
            document.getElementById('email-view').innerHTML = '<div class="text-slate-300 italic text-center mt-6">Drafting...</div>';

            // P - PLAN (The Corrected Graph Logic)
            setStep('p');
            await log("Accessing ML Prediction Models...");
			await sleep(800);
            const container = document.getElementById('graph-container');
           
container.querySelectorAll('.bar-col').forEach(el => el.remove());

            data.values.forEach((val, i) => {
                const barWrapper = document.createElement('div');
                barWrapper.className = "bar-col flex-1 flex flex-col justify-end items-center h-full group";
                // Inner Bar logic: Corrected to show relative height
                barWrapper.innerHTML = `
						  <div class="w-full bg-slate-50 rounded-t border-x border-t border-slate-100 flex items-end h-full relative">
							
							<!-- % label -->
							<div class="absolute -top-3 left-1/2 -translate-x-1/2 text-[9px] font-bold text-slate-400 opacity-0 group-hover:opacity-100 transition">
							  ${val}%
							</div>

							<!-- bar -->
							<div class="bar-grow w-full bg-[#00A3AD] rounded-t" style="height: 0%"></div>
						  </div>

						  <span class="text-[8px] mt-1 text-slate-400 font-bold">${months[i]}</span>
						`;
                container.appendChild(barWrapper);
                // Trigger animation
                setTimeout(() => {
                    barWrapper.querySelector('.bar-grow').style.height = `${val}%`;
                }, i * 40);
            });
            document.getElementById('peak-indicator').innerText = `PEAK: ${data.peak.toUpperCase()}`;
            await log(`Potential Peak: ${data.peak}. Targeting focus: ${data.focus}.`, "white");

            // A - ACT
            setStep('a');
            await log("Reasoning over physician segment behavior...");
			await sleep(800);
            await log("Selected Channel: Omnichannel Email & Display Banners.");

            // W - WORK
            setStep('w');
            await log("Generative Engine engaged...");
			await sleep(800);
            if (apiKey) {
                await fetchGemini(data);
            } else {
                await showMock(data);
            }

            // O - OPTIMIZE
            setStep('o');
            await log("Deployment complete. Monitoring KPIs...", "white");
			await sleep(800);
            isRunning = false;
        }

window.addEventListener("DOMContentLoaded", () => {
  updateApiIndicator();
});
        async function showMock(data) {
            document.getElementById('email-view').innerHTML = `
                <div class="font-bold border-b pb-1 mb-2 text-blue-900">Subject: ${data.name} Clinical Update: Preparedness for ${data.peak}</div>
                <p>Dear Healthcare Professional,</p>
                <p>Based on our latest predictive modeling, we anticipate a high presentation of ${data.focus} cases starting this ${data.peak}.</p>
                <p>Recent efficacy studies of ${data.name} show significant improvement in outcomes when started as a first-line treatment.</p>
                <div class="my-2 p-2 bg-white border rounded italic border-teal-200">"94% of observed specialists suggest early adoption for patients in the ${data.peak} window."</div>
                <p>Best regards,<br>The Medical Strategy Team</p>
            `;
            document.getElementById('banner-view').innerHTML = `
                <div class="text-center space-y-2">
                    <div class="text-[9px] font-bold text-[#00A3AD] uppercase tracking-widest">${data.name}</div>
                    <div class="text-lg font-bold text-[#002d62] leading-tight">Prepare for<br>${data.peak} Peaks</div>
                    <div class="bg-[#002d62] text-white px-3 py-1 rounded-full text-[9px] font-bold">Explore Data</div>
                </div>
            `;
        }

        async function fetchGemini(data) {
            const prompt = `Pharma Marketing Prompt: Molecule: ${data.name}, Focus: ${data.focus}, Month: ${data.peak}. Create a 2-paragraph professional medical marketing email and a 4-word banner headline. Format JSON: {"email": "...", "headline": "..."}`;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } })
                });
                const resData = await response.json();
                const json = JSON.parse(resData.candidates[0].content.parts[0].text);
                document.getElementById('email-view').innerHTML = json.email.replace(/\n/g, '<br>');
                document.getElementById('banner-view').innerHTML = `<div class="text-center"><div class="text-lg font-bold text-[#002d62]">${json.headline}</div><div class="text-xs text-[#00A3AD] mt-2">${data.name}</div></div>`;
            } catch (e) {
                await log("Gemini Error - Using Mock Data", "red-400");
                showMock(data);
            }
        }
    </script>
</body>
</html>
